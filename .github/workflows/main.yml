name: Build Executables

on: 
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

permissions:
  contents: write 

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest] 

    steps:
      - name: Check out Repository
        uses: actions/checkout@v3

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller

      - name: Debugging PrÃ¼fe start.py
        run: ls -l start.py || echo "start.py nicht gefunden!"

      - name: Debugging PrÃ¼fe PyInstaller
        run: |
          python --version
          pip show pyinstaller || echo "PyInstaller nicht installiert!"

      - name: Build Executable
        run: |
          pyinstaller --onefile --windowed --name netzwerkanalyse-${{ runner.os }} start.py

      - name: Debugging Zeige Inhalt von dist/
        run: ls -l dist/ || echo "Kein Output gefunden in dist/"

      - name: Release Build
        uses: softprops/action-gh-release@v1
        with:
          files: dist/*
          tag_name: latest
          draft: false
          prerelease: false
          body: |
            # Netzwerkanalyse Tool â€“ Builds & Hinweise

            Hier findest du die neuesten Builds fÃ¼r **Windows**, **macOS** und **Linux**.
            
            ğŸ”¹ **Testdaten fÃ¼r das Tool findest du im Repository unter [`datasets-testen`](https://github.com/useruser300/Netzwerkanalyse/tree/main/datasets-testen)**
            
            ---

            ## SystemkompatibilitÃ¤t â€“ bitte vor dem Download beachten

            | Betriebssystem | UnterstÃ¼tzt | Nicht kompatibel |
            |----------------|-------------|------------------|
            | ğŸ§ **Linux**   | âœ… x86-64 Architektur (z.â€¯B. Intel i5, i7, i9) | âŒ ARM-basierte Systeme (z.â€¯B. Raspberry Pi, ARM64-Server) |
            | ğŸ **macOS**   | âœ… Apple Silicon (ARM64 â€“ M1, M2, M3)           | âŒ Intel-basierte Macs |
            | ğŸªŸ **Windows** | âœ… Windows mit x86-64 Architektur               | âš ï¸ ARM-Windows wird aktuell nicht unterstÃ¼tzt |

            ---

            ## Erste Schritte & mÃ¶gliche Fehlermeldungen

            Je nach Betriebssystem kann es beim ersten Start zu Warnungen oder Problemen kommen. Hier findest du einfache LÃ¶sungen:

            ---

            ### ğŸ§ **Linux â€“ Datei wird nicht erkannt**

            **Fehlermeldung:**  
            `Could Not Display â€˜netzwerkanalyse-Linuxâ€™ â€“ There is no app installed for â€˜Executableâ€™ files`

            **Ursache:** Die Datei wurde nicht automatisch als ausfÃ¼hrbar erkannt.

            #### LÃ¶sung:

            1. **Terminal Ã¶ffnen**  
            2. In den Ordner mit der Datei wechseln (z.â€¯B. Downloads):  
               ```bash
               cd ~/Downloads
               ```

            3. Datei ausfÃ¼hrbar machen:  
               ```bash
               chmod +x netzwerkanalyse-Linux
               ```

            4. Programm starten:  
               ```bash
               ./netzwerkanalyse-Linux
               ```

            ---

            ### ğŸ **macOS â€“ Datei kann nicht geÃ¶ffnet werden**

            **Fehlermeldung:**  
            `â€œnetzwerkanalyse-macOSâ€ canâ€™t be opened because Apple cannot check it for malicious software.`

            **Ursache:** macOS blockiert neue, nicht verifizierte Apps.

            #### LÃ¶sung:

            1. **Terminal Ã¶ffnen**  
            2. In den Ordner mit der Datei wechseln (z.â€¯B. Downloads):  
               ```bash
               cd ~/Downloads
               ```

            3. Datei ausfÃ¼hrbar machen:  
               ```bash
               chmod +x netzwerkanalyse-macOS
               ```

            4. SicherheitsbeschrÃ¤nkung entfernen:  
               ```bash
               xattr -d com.apple.quarantine netzwerkanalyse-macOS
               ```

            5. Programm starten:  
               ```bash
               ./netzwerkanalyse-macOS
               ```

            ---

            ### ğŸªŸ **Windows â€“ SmartScreen-Warnung**

            **Fehlermeldung:**  
            `â€œnetzwerkanalyse-Windows.exe isnâ€™t commonly downloadedâ€`

            **Ursache:** Die Datei ist neu und nicht signiert, daher zeigt Windows eine Schutzmeldung.

            #### LÃ¶sung:

            1. Klicke auf **â€Mehr anzeigenâ€œ (See more)**  
            2. Klicke auf **â€Behaltenâ€œ (Keep)**  
            3. **Rechtsklick auf die Datei â†’ Eigenschaften**  
            4. Setze (falls sichtbar) den Haken bei **â€Zulassenâ€œ**, dann auf **OK** klicken  
            5. **Doppelklick**, um die Datei zu starten

            ğŸ”§ **Wenn die Datei trotzdem blockiert wird:**

            1. Rechtsklick auf die Datei â†’ **â€Als Administrator ausfÃ¼hrenâ€œ**  
            2. Wenn Windows fragt: **â€MÃ¶chten Sie diese App ausfÃ¼hren?â€œ â†’ Ja**

            ---

            Viel SpaÃŸ beim Testen â€“ und danke fÃ¼r dein Feedback!  
            â¡ï¸ Gib dein Feedback hier ab: [Feedback-Seite Ã¶ffnen](https://umfragen.tu-dortmund.de/index.php/614683?lang=de)  
            Bei Fragen oder Fehlern gerne per Mail an: [ali.almazaal@gmail.com](ali.almazaal@gmail.com)
